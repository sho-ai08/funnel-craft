# マーケティング導線3D可視化アプリ 実施計画書

## プロジェクト概要

- **プロジェクト名**: マーケティング導線3D可視化アプリ
- **デプロイ先**: Vercel
- **バージョン管理**: GitHub
- **目標**: Webアプリケーションのデプロイ完了

---

## Phase 1: プロジェクト基盤構築 ✅

### 目的
開発環境のセットアップと技術スタックの確立

### タスク
- [x] Viteを使用したReactプロジェクトの初期化
- [x] Git初期化とGitHubリポジトリの作成
- [x] 必要なライブラリのインストール
  - [x] `@react-three/fiber` (React Three Fiber v8.15.0)
  - [x] `@react-three/drei` (Three.js helpers v9.92.0)
  - [x] `three` (Three.js本体 v0.160.0)
  - [x] `zustand` (状態管理 v5.0.8)
  - [x] `tailwindcss` (UIスタイリング)
  - [x] その他ユーティリティライブラリ (nanoid, jspdf, html2canvas)
- [x] Tailwind CSSのセットアップ
- [x] プロジェクト構造の設計
  ```
  src/
  ├── components/
  │   ├── 3d/          # 3D関連コンポーネント
  │   ├── ui/          # UIコンポーネント
  │   └── layout/      # レイアウトコンポーネント
  ├── store/           # Zustand store
  ├── types/           # TypeScript型定義
  ├── utils/           # ユーティリティ関数
  └── App.tsx
  ```
- [x] TypeScript設定の確認・調整
- [x] ESLint/Prettier設定

### 成果物
- 初期化されたReactプロジェクト ✅
- Git初期化とコミット ✅
- インストール済みの依存関係 ✅

### 完了日
2025-11-26

### 所要時間目安
1-2時間

---

## Phase 2: 3D基本ビューの実装 ✅

### 目的
Three.jsの基本的な3Dシーンとカメラコントロールの実装

### タスク
- [x] React Three Fiberでの基本シーン構築
- [x] Canvas設定（背景色、アンチエイリアス等）
- [x] OrbitControlsの実装
  - [x] 左ドラッグで視点回転
  - [x] マウスホイールでズーム
  - [x] 右ドラッグでパン移動
- [x] グリッド・軸ヘルパーの追加（開発用）
- [x] 基本的なライティング設定
  - [x] AmbientLight（環境光）
  - [x] DirectionalLight（指向性ライト）
- [x] テスト用の球体ノードを配置して動作確認

### 成果物
- 3Dシーンを表示できる基本コンポーネント (Scene.tsx) ✅
- カメラコントロールが動作する3Dビュー ✅
- テストノード3個（青/緑/オレンジ） ✅

### 完了日
2025-11-26

### 所要時間目安
2-3時間

---

## Phase 3: データ構造と状態管理 ✅

### 目的
アプリケーション全体のデータ構造とストアの設計・実装

### 完了日
2025-11-26

### タスク
- [ ] TypeScript型定義の作成
  ```typescript
  // ノード型
  interface Node {
    id: string;
    title: string;
    url?: string;
    category: 'traffic' | 'cashpoint';
    type: 'sns' | 'article' | 'ad' | 'frontend' | 'backend';
    description?: string;
    metrics: Metric[];
    position: { x: number; y: number; z: number };
  }

  // メトリクス型
  interface Metric {
    name: string;
    value: number;
  }

  // リンク型
  interface Link {
    id: string;
    source: string;
    target: string;
  }
  ```
- [ ] Zustandストアの設計
  - [ ] ノード配列の管理
  - [ ] リンク配列の管理
  - [ ] 選択状態の管理
  - [ ] UI状態の管理
- [ ] CRUD操作関数の実装
  - [ ] `addNode(node: Node)`
  - [ ] `updateNode(id: string, updates: Partial<Node>)`
  - [ ] `deleteNode(id: string)`
  - [ ] `addLink(link: Link)`
  - [ ] `deleteLink(id: string)`
- [ ] ユニークID生成ユーティリティ（nanoid等）

### 成果物
- 型定義ファイル
- Zustandストア
- CRUD操作関数

### 所要時間目安
2-3時間

---

## Phase 4: ノード管理機能 ✅

### 目的
ノードの追加・編集・削除・移動機能の実装

### 完了日
2025-11-26 (95%完了)

### タスク
- [ ] ノードの3D表示コンポーネント作成
  - [ ] 種類別の色分け実装
    - SNS投稿: 青系 (#3B82F6)
    - 記事: 緑系 (#10B981)
    - 広告: 黄系 (#F59E0B)
    - フロントエンド: オレンジ系 (#F97316)
    - バックエンド: 赤系 (#EF4444)
  - [ ] ノードラベル（タイトル）の表示
  - [ ] ホバー時のハイライト効果
- [ ] ノード追加機能
  - [ ] 「+」ボタンUI
  - [ ] デフォルト位置での新規ノード作成
- [ ] ノード編集パネル（モーダル/サイドパネル）
  - [ ] タイトル入力フィールド
  - [ ] URL入力フィールド
  - [ ] カテゴリ選択（ラジオボタン/セレクト）
  - [ ] 種類選択（ドロップダウン）
  - [ ] 説明文テキストエリア
  - [ ] カスタムメトリクス管理UI
    - [ ] メトリクス追加ボタン
    - [ ] 項目名・値の入力フィールド
    - [ ] メトリクス削除ボタン
    - [ ] 最大10項目の制限
  - [ ] 保存ボタン
  - [ ] キャンセルボタン
- [ ] ノード削除機能
  - [ ] 削除ボタン
  - [ ] 確認ダイアログ
  - [ ] Deleteキーでの削除対応
- [ ] ノードのドラッグ&ドロップ移動
  - [ ] DragControlsの実装
  - [ ] 移動中の視覚フィードバック
  - [ ] 位置情報の更新

### 成果物
- ノード3D表示コンポーネント
- ノード編集パネルコンポーネント
- ノード操作機能一式

### 所要時間目安
4-5時間

---

## Phase 5: リンク管理機能

### 目的
ノード間のリンク（エッジ）の作成・削除機能の実装

### タスク
- [ ] リンク（エッジ）の3D描画
  - [ ] Line または Tube ジオメトリでの線描画
  - [ ] 矢印の表示（ArrowHelper または カスタムコーン）
  - [ ] リンクの方向性の可視化
- [ ] リンク作成機能（方法A: ドラッグ&ドロップ）
  - [ ] ノード端からのドラッグ開始検出
  - [ ] ドラッグ中の一時的な線の表示
  - [ ] ターゲットノードへのドロップ検出
  - [ ] リンク確定処理
- [ ] リンク作成機能（方法B: クリック選択）
  - [ ] 「リンク追加モード」のトグル
  - [ ] ソースノード選択
  - [ ] ターゲットノード選択
  - [ ] リンク作成完了
- [ ] リンク選択機能
  - [ ] クリックでのリンク選択
  - [ ] 選択時のハイライト表示
- [ ] リンク削除機能
  - [ ] 削除ボタン
  - [ ] Deleteキーでの削除
  - [ ] 関連ノード削除時の自動削除

### 成果物
- リンク3D表示コンポーネント
- リンク作成UI（2方式）
- リンク削除機能

### 所要時間目安
3-4時間

---

## Phase 6: UI/レイアウトの実装

### 目的
アプリケーションの全体的なレイアウトとUIコンポーネントの実装

### タスク
- [ ] ヘッダーコンポーネント
  - [ ] アプリタイトル表示
  - [ ] 保存ボタン
  - [ ] 読み込みボタン
  - [ ] エクスポートボタン（PDF/PNG選択ドロップダウン）
  - [ ] Tailwind CSSでのスタイリング
- [ ] サイドパネルコンポーネント
  - [ ] ノード追加ボタン（+）
  - [ ] ノード一覧表示
    - [ ] カテゴリ別グルーピング
    - [ ] 折りたたみ機能（Accordion）
    - [ ] ノードクリックで選択・フォーカス
  - [ ] 検索フィルター
    - [ ] タイトル検索入力欄
    - [ ] リアルタイムフィルタリング
  - [ ] 自動レイアウトボタン
  - [ ] リセットビューボタン
  - [ ] オートフィットボタン
- [ ] ステータスバーコンポーネント
  - [ ] ノード総数表示
  - [ ] リンク総数表示
  - [ ] 操作ヒント表示
  - [ ] 選択中のノード情報表示
- [ ] レスポンシブレイアウト調整
  - [ ] サイドパネルの開閉機能（狭い画面用）
  - [ ] 3Dビューエリアのサイズ調整

### 成果物
- ヘッダーコンポーネント
- サイドパネルコンポーネント
- ステータスバーコンポーネント
- 統合されたメインレイアウト

### 所要時間目安
3-4時間

---

## Phase 7: レイアウト・ビュー機能

### 目的
自動レイアウトとビューコントロール機能の実装

### タスク
- [ ] 手動配置機能の完成
  - [ ] ドラッグ&ドロップでの3D空間内移動
  - [ ] X, Y, Z軸方向への自由移動
- [ ] 自動レイアウトアルゴリズムの実装
  - [ ] 階層型レイアウトの実装
    - [ ] カテゴリ・種類に基づく階層分析
    - [ ] 集客ノードを左側に配置
    - [ ] キャッシュポイントノードを右側に配置
    - [ ] リンク構造に基づく中間配置
  - [ ] 力学ベースレイアウト（3d-force-graph参考）
  - [ ] レイアウト実行ボタンの実装
  - [ ] アニメーション遷移
- [ ] リセットビュー機能
  - [ ] カメラ位置の初期化
  - [ ] カメラターゲットのリセット
  - [ ] スムーズなカメラ遷移
- [ ] オートフィット機能
  - [ ] 全ノードのバウンディングボックス計算
  - [ ] カメラ位置の自動調整
  - [ ] 全ノードが画面内に収まる表示

### 成果物
- 自動レイアウト機能
- リセットビュー機能
- オートフィット機能

### 所要時間目安
3-4時間

---

## Phase 8: 保存・読み込み機能

### 目的
プロジェクトデータの永続化機能の実装

### タスク
- [ ] プロジェクトデータのJSON変換
  - [ ] ノード配列のシリアライズ
  - [ ] リンク配列のシリアライズ
  - [ ] メタ情報の追加（version, exportedAt）
- [ ] JSON保存機能
  - [ ] データのJSON文字列化
  - [ ] Blob生成
  - [ ] ファイルダウンロード処理
  - [ ] ファイル名生成（日時付き）
- [ ] JSON読み込み機能
  - [ ] ファイル選択ダイアログ
  - [ ] ファイル読み込み処理
  - [ ] JSONパース
  - [ ] データバリデーション
    - [ ] 必須フィールドのチェック
    - [ ] 型の検証
    - [ ] バージョン互換性チェック
  - [ ] ストアへのデータ復元
- [ ] 確認ダイアログ
  - [ ] 読み込み前の確認メッセージ
  - [ ] データ破棄の警告
  - [ ] ユーザー同意の取得
- [ ] エラーハンドリング
  - [ ] 不正なJSONの処理
  - [ ] 破損ファイルの処理
  - [ ] ユーザーフレンドリーなエラーメッセージ

### 成果物
- JSON保存機能
- JSON読み込み機能
- データバリデーション機能

### 所要時間目安
2-3時間

---

## Phase 9: エクスポート機能

### 目的
3Dビューのエクスポート機能（PNG/PDF）の実装

### タスク
- [ ] PNG出力機能
  - [ ] Three.jsレンダラーからの画像抽出
  - [ ] Canvas要素の取得
  - [ ] toDataURL/toBlobの使用
  - [ ] 高解像度出力オプション
  - [ ] ファイルダウンロード処理
- [ ] PDF出力機能の準備
  - [ ] `jspdf`ライブラリのインストール
  - [ ] `html2canvas`ライブラリのインストール
- [ ] PDF出力機能の実装
  - [ ] 3Dビューのスクリーンショット取得
  - [ ] ノード一覧表の生成
    - [ ] カテゴリ別にグループ化
    - [ ] タイトル、種類、URL、説明の表示
    - [ ] メトリクスデータの表示
  - [ ] PDFドキュメント生成
    - [ ] ページ1: 3Dビュー画像
    - [ ] ページ2以降: ノード一覧表
  - [ ] PDFダウンロード処理
- [ ] エクスポートオプションUI
  - [ ] PNG/PDF選択ドロップダウン
  - [ ] 解像度設定（オプション）
  - [ ] エクスポート実行ボタン

### 成果物
- PNG出力機能
- PDF出力機能（3Dビュー + ノード一覧表）
- エクスポートUI

### 所要時間目安
3-4時間

---

## Phase 10: 最終調整とテスト

### 目的
パフォーマンス最適化とユーザビリティの向上

### タスク
- [ ] パフォーマンス最適化
  - [ ] React.memoの適用
  - [ ] useCallbackの適用
  - [ ] 不要な再レンダリングの削減
  - [ ] Three.jsオブジェクトのdispose処理
  - [ ] 100ノード環境でのパフォーマンステスト
  - [ ] 60fps維持の確認
- [ ] ツールチップの追加
  - [ ] ボタンへのツールチップ
  - [ ] 操作ガイド表示
  - [ ] ノードホバー時の情報表示
- [ ] キーボードショートカット実装
  - [ ] Delete: 選択したノード/リンクの削除
  - [ ] Ctrl+S: プロジェクト保存
  - [ ] Ctrl+Z: Undo（オプション）
  - [ ] Escape: 選択解除/モーダル閉じる
- [ ] エラーハンドリング強化
  - [ ] 境界値テスト
  - [ ] 異常データの処理
  - [ ] エラーバウンダリの実装
  - [ ] ユーザー通知（トースト）の実装
- [ ] アクセシビリティ改善
  - [ ] キーボードナビゲーション
  - [ ] ARIAラベル
  - [ ] フォーカス管理
- [ ] ユーザビリティテスト
  - [ ] 実際のユースケースでのテスト
  - [ ] UI/UXの改善点の洗い出し
  - [ ] バグ修正

### 成果物
- 最適化されたアプリケーション
- ツールチップ機能
- キーボードショートカット
- エラーハンドリング機能

### 所要時間目安
4-5時間

---

## Phase 11: デプロイ準備

### 目的
本番環境へのデプロイに向けた準備

### タスク
- [ ] 本番ビルド設定の確認
  - [ ] Vite設定の確認
  - [ ] 本番ビルドの実行テスト
  - [ ] ビルドサイズの確認・最適化
- [ ] 環境変数の整理
  - [ ] `.env.example`の作成
  - [ ] 必要な環境変数のドキュメント化
- [ ] README.md作成
  - [ ] プロジェクト概要
  - [ ] 機能説明
  - [ ] セットアップ手順
  - [ ] 開発環境の構築方法
  - [ ] 本番ビルド方法
  - [ ] 使用技術スタック
  - [ ] スクリーンショット
- [ ] ドキュメント整備
  - [ ] コードコメントの追加
  - [ ] APIドキュメント（必要に応じて）
  - [ ] ユーザーガイド（docs/user_guide.md）
- [ ] ライセンス設定
  - [ ] LICENSE ファイルの追加
- [ ] .gitignoreの確認
  - [ ] node_modules
  - [ ] dist
  - [ ] .env

### 成果物
- 本番ビルド設定
- README.md
- ドキュメント一式
- デプロイ準備完了状態

### 所要時間目安
2-3時間

---

## Phase 12: デプロイ実行

### 目的
Vercelへのデプロイとリリース

### タスク
- [ ] GitHubリポジトリの最終確認
  - [ ] すべての変更がコミット済み
  - [ ] 適切なコミットメッセージ
  - [ ] ブランチ戦略の確認（main/developなど）
- [ ] Vercelプロジェクト設定
  - [ ] Vercelアカウントへのログイン
  - [ ] 新規プロジェクト作成
  - [ ] GitHubリポジトリとの連携
  - [ ] ビルド設定
    - Build Command: `npm run build`
    - Output Directory: `dist`
    - Install Command: `npm install`
  - [ ] 環境変数の設定（必要に応じて）
- [ ] デプロイ実行
  - [ ] 初回デプロイ
  - [ ] デプロイログの確認
  - [ ] ビルドエラーの修正（必要に応じて）
- [ ] 本番環境での動作確認
  - [ ] すべての機能の動作テスト
  - [ ] ノード追加・編集・削除
  - [ ] リンク作成・削除
  - [ ] 保存・読み込み
  - [ ] エクスポート（PNG/PDF）
  - [ ] 3Dビュー操作
  - [ ] パフォーマンス確認
- [ ] カスタムドメイン設定（オプション）
  - [ ] ドメインの追加
  - [ ] DNS設定
  - [ ] SSL証明書の確認
- [ ] 継続的デプロイの確認
  - [ ] mainブランチへのプッシュで自動デプロイ
  - [ ] プレビューデプロイの確認

### 成果物
- Vercelへのデプロイ完了
- 本番環境URL
- 動作確認済みのWebアプリケーション

### 所要時間目安
1-2時間

---

## 総所要時間目安
**30-40時間**

---

## リスクと対策

### リスク1: 3Dパフォーマンスの問題
- **対策**: 早期にパフォーマンステストを実施し、最適化の優先順位を上げる

### リスク2: ブラウザ互換性の問題
- **対策**: 主要ブラウザ（Chrome, Firefox, Edge）での定期的なテスト

### リスク3: 複雑なドラッグ&ドロップ実装
- **対策**: React Three DreiのDragControlsを活用、段階的に機能を実装

### リスク4: PDF出力の品質問題
- **対策**: 複数のライブラリを検討、必要に応じて画像出力のみに変更

---

## 次のアクション

1. Phase 1から順次実装開始
2. 各Phase完了時にGitコミット
3. 主要Phase（2, 4, 5, 6）完了後にGitHubへプッシュ
4. 定期的な動作確認とテスト実施
5. claude.mdファイルで進捗を記録

---

**作成日**: 2025-11-26
**最終更新**: 2025-11-26
